AC_INIT(vidalia,0.0.8-svn)
AC_MSG_NOTICE([Configuring AC_PACKAGE_STRING...])
AC_PROG_CXX
PROFILE="Vidalia.pro"

dnl Find qmake
AC_PATH_PROG(QMAKE, qmake)
if test x$QMAKE = x; then
  AC_MSG_ERROR([qmake must be in your path])
fi

dnl Find lrelease
AC_PATH_PROG(LRELEASE, lrelease)
if test x$LRELEASE = x; then
  AC_MSG_ERROR([lrelease must be in your path])
fi

dnl Find chmod
AC_PATH_PROG(CHMOD, chmod, chmod)

dnl Determine whether we should link to the debug versions of Qt or not
BUILDMODE="debug"
AC_ARG_ENABLE(debug,
    AC_HELP_STRING(--disable-debug, Disable debugging support))
if test x$enable_debug = xno; then
  BUILDMODE="release"
fi
AC_MSG_NOTICE([Building in $BUILDMODE mode])

dnl Clean out an existing Makefile
AC_CHECK_FILE(Makefile, [rm Makefile])

dnl Substitute the version number in places that need it
AC_SUBST(VERSION, AC_PACKAGE_VERSION)
DOCS="doc"
OSXBUNDLE="pkg/osx/bundle"
OSXDMG="pkg/osx"
AC_OUTPUT([$DOCS/vidalia.1                    \
           $OSXDMG/builddmg.sh                \
           $OSXBUNDLE/buildmpkg.sh            \
           $OSXBUNDLE/VidaliaBundleDesc.plist \
           $OSXBUNDLE/VidaliaBundleInfo.plist \
           $OSXBUNDLE/VidaliaDesc.plist       \
           $OSXBUNDLE/VidaliaInfo.plist])

dnl Make the mpkg and dmg scripts executable
if test x$CHMOD != x; then
  $CHMOD u+x $OSXBUNDLE/buildmpkg.sh
fi
if test x$CHMOD != x; then
  $CHMOD u+x $OSXDMG/builddmg.sh
fi

dnl Build the translations
AC_MSG_NOTICE([Processing language translations...])
$LRELEASE $PROFILE

dnl Make sure ${prefix} (which can be contained in $mandir) is evaluted 
dnl before passing it to qmake
MANPAGEDIR=`eval echo $mandir`

dnl Run qmake to generate the Makefile
AC_MSG_NOTICE([Running qmake...])
$QMAKE -config $BUILDMODE PREFIX=$prefix MANDIR=$MANPAGEDIR $PROFILE

